{"version":3,"file":"index.m.js","sources":["../src/index.js"],"sourcesContent":["import { PureComponent } from 'react'\nimport PropTypes from 'prop-types'\nimport MapboxGeocoder from '@mapbox/mapbox-gl-geocoder'\nimport { FlyToInterpolator } from 'react-map-gl'\nimport WebMercatorViewport from 'viewport-mercator-project'\nimport mapboxgl from 'mapbox-gl'\n\nconst VALID_POSITIONS = ['top-left', 'top-right', 'bottom-left', 'bottom-right']\n\nclass Geocoder extends PureComponent {\n  geocoder = null\n  cachedResult = null\n\n  componentDidMount() {\n    this.initializeGeocoder()\n  }\n\n  componentWillUnmount() {\n    this.removeGeocoder()\n  }\n\n  componentDidUpdate() {\n    this.removeGeocoder()\n    this.initializeGeocoder()\n  }\n\n  initializeGeocoder = () => {\n    const mapboxMap = this.getMapboxMap()\n    const containerNode = this.getContainerNode()\n    const {\n      mapboxApiAccessToken,\n      inputValue,\n      origin,\n      zoom,\n      placeholder,\n      proximity,\n      trackProximity,\n      collapsed,\n      clearAndBlurOnEsc,\n      clearOnBlur,\n      bbox,\n      types,\n      countries,\n      minLength,\n      limit,\n      language,\n      filter,\n      localGeocoder,\n      localGeocoderOnly,\n      reverseGeocode,\n      enableEventLogging,\n      marker,\n      render,\n      getItemValue,\n      onInit,\n      position\n    } = this.props\n    const options = {\n      accessToken: mapboxApiAccessToken,\n      origin,\n      zoom,\n      flyTo: false,\n      placeholder,\n      proximity,\n      trackProximity,\n      collapsed,\n      clearAndBlurOnEsc,\n      clearOnBlur,\n      bbox,\n      types,\n      countries,\n      minLength,\n      limit,\n      language,\n      filter,\n      localGeocoder,\n      localGeocoderOnly,\n      reverseGeocode,\n      enableEventLogging,\n      marker,\n      mapboxgl\n    }\n\n    if (render && typeof render === 'function') {\n      options.render = render\n    }\n\n    if (getItemValue && typeof getItemValue === 'function') {\n      options.getItemValue = getItemValue\n    }\n\n    this.geocoder = new MapboxGeocoder(options)\n    this.subscribeEvents()\n\n    if (containerNode) {\n      containerNode.appendChild(this.geocoder.onAdd(mapboxMap))\n    } else {\n      mapboxMap.addControl(this.geocoder, VALID_POSITIONS.find((_position) => position === _position))\n    }\n\n    if (inputValue !== undefined && inputValue !== null) {\n      this.geocoder.setInput(inputValue)\n    } else if (this.cachedResult) {\n      this.geocoder.setInput(this.cachedResult.place_name)\n    }\n\n    if (this.cachedResult || (inputValue !== undefined && inputValue !== null)) {\n      this.showClearIcon()\n    }\n\n    onInit(this.geocoder)\n  }\n\n  showClearIcon = () => {\n    // this is a hack to force clear icon to show if there is text in the input\n    this.geocoder._clearEl.style.display = 'block'\n  }\n\n  getMapboxMap = () => {\n    const { mapRef } = this.props\n\n    return (mapRef && mapRef.current && mapRef.current.getMap()) || null\n  }\n\n  getContainerNode = () => {\n    const { containerRef } = this.props\n\n    return (containerRef && containerRef.current) || null\n  }\n\n  subscribeEvents = () => {\n    this.geocoder.on('clear', this.handleClear)\n    this.geocoder.on('loading', this.handleLoading)\n    this.geocoder.on('results', this.handleResults)\n    this.geocoder.on('result', this.handleResult)\n    this.geocoder.on('error', this.handleError)\n  }\n\n  unsubscribeEvents = () => {\n    this.geocoder.off('clear', this.handleClear)\n    this.geocoder.off('loading', this.handleLoading)\n    this.geocoder.off('results', this.handleResults)\n    this.geocoder.off('result', this.handleResult)\n    this.geocoder.off('error', this.handleError)\n  }\n\n  removeGeocoder = () => {\n    const mapboxMap = this.getMapboxMap()\n\n    this.unsubscribeEvents()\n\n    if (mapboxMap && mapboxMap.removeControl) {\n      this.getMapboxMap().removeControl(this.geocoder)\n    }\n\n    this.geocoder = null\n  }\n\n  handleClear = () => {\n    this.cachedResult = null\n    this.props.onClear()\n  }\n\n  handleLoading = (event) => {\n    this.props.onLoading(event)\n  }\n\n  handleResults = (event) => {\n    this.props.onResults(event)\n  }\n\n  handleResult = (event) => {\n    const { result } = event\n    const { onViewportChange, onResult } = this.props\n    const { bbox, center, properties = {} } = result\n    const { short_code } = properties\n    const [longitude, latitude] = center\n    const bboxExceptions = {\n      fr: {\n        name: 'France',\n        bbox: [[-4.59235, 41.380007], [9.560016, 51.148506]]\n      },\n      us: {\n        name: 'United States',\n        bbox: [[-171.791111, 18.91619], [-66.96466, 71.357764]]\n      },\n      ru: {\n        name: 'Russia',\n        bbox: [[19.66064, 41.151416], [190.10042, 81.2504]]\n      },\n      ca: {\n        name: 'Canada',\n        bbox: [[-140.99778, 41.675105], [-52.648099, 83.23324]]\n      }\n    }\n    const { width, height } = this.getMapboxMap()\n      .getContainer()\n      .getBoundingClientRect()\n    let zoom = this.geocoder.options.zoom\n    const fitBounds = (bounds, viewport) => new WebMercatorViewport(viewport).fitBounds(bounds)\n\n    try {\n      if (!bboxExceptions[short_code] && bbox) {\n        zoom = fitBounds([[bbox[0], bbox[1]], [bbox[2], bbox[3]]], { width, height }).zoom\n      } else if (bboxExceptions[short_code]) {\n        zoom = fitBounds(bboxExceptions[short_code].bbox, { width, height }).zoom\n      }\n    } catch (e) {\n      console.warn('following result caused an error when trying to zoom to bbox: ', result) // eslint-disable-line\n      zoom = this.geocoder.options.zoom\n    }\n\n    onViewportChange({\n      longitude,\n      latitude,\n      zoom,\n      transitionInterpolator: new FlyToInterpolator(),\n      transitionDuration: 3000\n    })\n    onResult(event)\n\n    this.cachedResult = result\n    this.geocoder._typeahead.selected = null\n    this.showClearIcon()\n  }\n\n  handleError = (event) => {\n    this.props.onError(event)\n  }\n\n  getGeocoder() {\n    return this.geocoder\n  }\n\n  render() {\n    return null\n  }\n\n  static propTypes = {\n    mapRef: PropTypes.object.isRequired,\n    containerRef: PropTypes.object,\n    onViewportChange: PropTypes.func,\n    mapboxApiAccessToken: PropTypes.string.isRequired,\n    inputValue: PropTypes.string,\n    origin: PropTypes.string,\n    zoom: PropTypes.number,\n    placeholder: PropTypes.string,\n    proximity: PropTypes.object,\n    trackProximity: PropTypes.bool,\n    collapsed: PropTypes.bool,\n    clearAndBlurOnEsc: PropTypes.bool,\n    clearOnBlur: PropTypes.bool,\n    bbox: PropTypes.array,\n    types: PropTypes.string,\n    countries: PropTypes.string,\n    minLength: PropTypes.number,\n    limit: PropTypes.number,\n    language: PropTypes.string,\n    filter: PropTypes.func,\n    localGeocoder: PropTypes.func,\n    localGeocoderOnly: PropTypes.bool,\n    reverseGeocode: PropTypes.bool,\n    enableEventLogging: PropTypes.bool,\n    marker: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n    render: PropTypes.func,\n    getItemValue: PropTypes.func,\n    position: PropTypes.oneOf(VALID_POSITIONS),\n    onInit: PropTypes.func,\n    onClear: PropTypes.func,\n    onLoading: PropTypes.func,\n    onResults: PropTypes.func,\n    onResult: PropTypes.func,\n    onError: PropTypes.func\n  }\n\n  static defaultProps = {\n    onViewportChange: () => {},\n    origin: 'https://api.mapbox.com',\n    zoom: 16,\n    placeholder: 'Search',\n    trackProximity: false,\n    collapsed: false,\n    clearAndBlurOnEsc: false,\n    clearOnBlur: false,\n    minLength: 2,\n    limit: 5,\n    reverseGeocode: false,\n    enableEventLogging: true,\n    marker: true,\n    position: 'top-right',\n    onInit: () => {},\n    onClear: () => {},\n    onLoading: () => {},\n    onResults: () => {},\n    onResult: () => {},\n    onError: () => {}\n  }\n}\n\nexport default Geocoder\n"],"names":["VALID_POSITIONS","Geocoder","geocoder","cachedResult","initializeGeocoder","mapboxMap","_this","getMapboxMap","containerNode","getContainerNode","props","inputValue","render","getItemValue","onInit","position","options","accessToken","mapboxApiAccessToken","origin","zoom","flyTo","placeholder","proximity","trackProximity","collapsed","clearAndBlurOnEsc","clearOnBlur","bbox","types","countries","minLength","limit","language","filter","localGeocoder","localGeocoderOnly","reverseGeocode","enableEventLogging","marker","mapboxgl","MapboxGeocoder","subscribeEvents","appendChild","onAdd","addControl","find","_position","setInput","place_name","showClearIcon","_clearEl","style","display","mapRef","current","getMap","containerRef","on","handleClear","handleLoading","handleResults","handleResult","handleError","unsubscribeEvents","off","removeGeocoder","removeControl","onClear","event","onLoading","onResults","result","onViewportChange","onResult","center","properties","short_code","longitude","latitude","bboxExceptions","fr","name","us","ru","ca","getContainer","getBoundingClientRect","width","height","fitBounds","bounds","viewport","WebMercatorViewport","e","console","warn","transitionInterpolator","FlyToInterpolator","transitionDuration","_typeahead","selected","onError","componentDidMount","this","componentWillUnmount","componentDidUpdate","getGeocoder","PureComponent","propTypes","PropTypes","object","isRequired","func","string","number","bool","array","oneOfType","oneOf","defaultProps"],"mappings":"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"}